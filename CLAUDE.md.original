# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

FirstMile Deals - Sales pipeline and customer analysis system for FirstMile shipping solutions. This codebase manages deal tracking, customer data analysis, rate calculations, and performance reporting for FirstMile's Xparcel shipping services.

## Core Business Context

FirstMile is a **carrier** (not a platform/3PL) offering Xparcel ship methods:
- **Xparcel Ground**: 3-8 day economy ground service
- **Xparcel Expedited**: 2-5 day faster ground solution (1-20 lb)
- **Xparcel Priority**: 1-3 day premium option with money-back guarantee

### Key Terminology
- "National Network": Nationwide coverage (all ZIPs)
- "Select Network": Metro-focused injection points (LA, DAL, ATL, ORD, EWR, etc.)
- Never name specific carriers (UPS, FedEx, USPS) - use "National" or "Select"
- Spell "eCommerce" with camel-case 'C'
- Xparcel is a ship-method under FirstMile, not a separate company

## High-Level Architecture

### Deal Pipeline Structure
The repository follows a 10-stage pipeline system (Nebuchadnezzar v2.0):
```
[00-LEAD] → [01-DISCOVERY-SCHEDULED] → [02-DISCOVERY-COMPLETE] →
[03-RATE-CREATION] → [04-PROPOSAL-SENT] → [05-SETUP-DOCS-SENT] →
[06-IMPLEMENTATION] → [07-CLOSED-WON] → [08-CLOSED-LOST] → [09-WIN-BACK]
```

Each deal folder contains customer-specific data, analysis scripts, and reports.

### Key Analysis Patterns

1. **PLD (Parcel Level Detail) Analysis**: Comprehensive shipping profile analysis covering carrier mix, service levels, weight distribution, dimensions, zones, and optimization opportunities. Standard flow:
   - Load shipment data (CSV/Excel)
   - Calculate volume metrics and daily averages
   - Analyze weight distribution with billable weight rules
   - Generate zone and geographic distribution
   - Create cost analysis and savings projections
   - Output Excel reports with professional formatting

2. **Performance Reporting**: Customer-facing reports following strict FirstMile brand standards:
   - SLA compliance (primary metric, always first)
   - Transit performance breakdowns
   - Geographic and zone analysis
   - In-transit status tracking
   - Excel output with 9 standard tabs

3. **Rate Calculation**: Complex multi-zone, multi-weight tier pricing matrices:
   - Extract current customer rates
   - Apply FirstMile pricing models
   - Calculate savings projections
   - Generate comparison matrices

## Commands

### Python Analysis Scripts
```bash
# Run PLD analysis on customer data
python [customer_folder]/pld_analysis.py

# Generate performance report
python [customer_folder]/firstmile_orchestrator.py

# Apply FirstMile rates and calculate savings
python [customer_folder]/apply_firstmile_rates.py
```

### Common Python Dependencies
```bash
pip install pandas numpy openpyxl xlsxwriter matplotlib seaborn plotly
```

## Critical Business Rules

### Billable Weight Calculation
ALL carriers follow these rules:
- Under 1 lb: Round UP to next whole oz, MAX 15.99 oz
- 16 oz exactly: Bills as 1 lb
- Over 1 lb: Round UP to next whole pound (32, 48, 64 oz, etc.)

### SLA Windows
- Xparcel Priority: 3 days
- Xparcel Expedited: 5 days
- Xparcel Ground: 8 days

### Performance Thresholds
- Perfect Compliance: 100%
- Exceeds Standard: ≥95%
- Meets Standard: ≥90%
- Below Standard: <90%

## Data Processing Patterns

### Standard CSV/Excel Loading
```python
import pandas as pd

# Handle various date formats
date_cols = ['created', 'delivered', 'ship_date', 'Request Date']
df = pd.read_csv(file, parse_dates=date_cols, dayfirst=False)

# Handle tracking numbers in scientific notation
df['tracking'] = df['tracking'].astype(str).str.replace('.0', '', regex=False)

# Standardize service level names
service_map = {
    'Ground': 'Xparcel Ground',
    'Expedited': 'Xparcel Expedited',
    'Priority': 'Xparcel Priority'
}
```

### Zone Analysis
Zones 1-8 with Regional (1-4) vs Cross-Country (5-8) grouping is a critical pattern for rate calculations and network optimization.

### Excel Report Generation
Professional Excel outputs use openpyxl with:
- FirstMile blue (#366092) headers with white text
- Auto-sized columns (max 50 chars)
- Conditional formatting for SLA compliance
- Standard 9-tab structure for performance reports

## Important File Locations

- **Customer Data**: `[stage-number]_[customer-name]/` folders
- **Rate Sheets**: Usually Excel files with zone/weight matrices in customer folders
- **Analysis Scripts**: Python files in customer folders
- **Reports**: Generated Excel/PDF files in customer folders
- **Templates**: `Brett_Walker_Instructions_v4.3.md` contains system instructions

## Analysis Workflow

1. **Data Ingestion**: Load customer shipment data (CSV/Excel)
2. **Standardization**: Map service levels, clean tracking numbers, parse dates
3. **Analysis**: Run PLD analysis, calculate metrics, identify patterns
4. **Rate Application**: Apply FirstMile pricing, calculate savings
5. **Report Generation**: Create professional Excel deliverables
6. **Pipeline Update**: Move deal to appropriate stage folder

## Key Metrics to Track

- **Volume**: Total shipments, daily average, monthly trends
- **Service Mix**: Distribution across Ground/Expedited/Priority
- **Weight Profile**: Packages by weight tier (critical for pricing)
- **Geographic Coverage**: Top states, zone distribution
- **Performance**: SLA compliance, transit times
- **Cost**: Current spend vs FirstMile savings projections

## Common Pitfalls to Avoid

- Never lead reports with daily delivery percentages (SLA compliance first)
- Don't name specific carriers - use "National" or "Select" network
- Always validate billable weight calculations match carrier rules
- Ensure date parsing handles both US and international formats
- Check for tracking numbers in scientific notation
- Verify service level mapping is consistent